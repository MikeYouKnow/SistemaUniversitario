{% extends "base.html" %}
{% block title %}Evaluaciones{% endblock %}

{% block content %}
<div class="container mt-4 page-wrapper">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h4 class="mb-1">Evaluación y calificaciones</h4>
      <p class="text-muted-soft mb-0">
        Selecciona una materia y actualiza las calificaciones de tus alumnos.
      </p>
    </div>
    <a href="{{ url_for('perfil_docente') }}" class="btn btn-outline-secondary btn-sm">
      ← Volver al panel del docente
    </a>
  </div>

  <div class="card-soft">
    <div class="card-soft-body">

      {% if materias_docente %}
        <form class="row g-2 mb-3" method="get" action="{{ url_for('docente_evaluaciones') }}">
          <div class="col-md-6">
            <label for="materia_alta_id" class="form-label">Materia</label>
            <select name="materia_alta_id" id="materia_alta_id"
                    class="form-select" onchange="this.form.submit()">
              {% for m in materias_docente %}
                <option value="{{ m.materia_alta_id }}"
                  {% if m.materia_alta_id|string == materia_alta_id|string %}selected{% endif %}>
                  {{ m.ciclo }} – {{ m.etiqueta }}
                </option>
              {% endfor %}
            </select>
          </div>
        </form>

        {% if calificaciones %}
          <div class="table-responsive">
            <table class="table table-sm table-striped align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th>Número de control</th>
                  <th>Alumno</th>
                  <th>Materia</th>
                  <th style="width: 210px;">Calificación</th>
                </tr>
              </thead>
              <tbody>
                {% for c in calificaciones %}
                <tr>
                  <td>{{ c.numero_control }}</td>
                  <td>{{ c.alumno }}</td>
                  <td>{{ c.materia_clave }} – {{ c.materia_nombre }}</td>
                  <td>
                    <form method="post" class="d-flex">
                      <input type="hidden" name="materia_alta_id" value="{{ materia_alta_id }}">
                      <input type="hidden" name="inscripcion_id" value="{{ c.inscripcion_id }}">
                      <input
                        type="number"
                        name="calificacion"
                        step="0.01"
                        min="0"
                        max="100"
                        class="form-control form-control-sm me-2"
                        value="{{ c.calificacion if c.calificacion is not none }}"
                      >
                      <button class="btn btn-sm btn-primary">
                        Guardar
                      </button>
                    </form>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="alert alert-info mb-0">
            No hay alumnos inscritos en esta materia.
          </div>
        {% endif %}
      {% else %}
        <div class="alert alert-warning mb-0">
          No tienes materias asignadas actualmente.  
          Pide al administrador o coordinador que te asigne grupos.
        </div>
      {% endif %}

    </div>
  </div>

</div>
{% endblock %}
